---
let mapData = null;

try {
  const res = await fetch('/functions/map');  // API'den harita verilerini alıyoruz
  if (res.ok) {
    mapData = await res.json();
  }
} catch (error) {
  console.error("Harita verisi yüklenemedi!", error);
}
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Google Maps API with Astro</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto" crossorigin="anonymous" />
  </head>
  <body>
    <h1>Google Maps API with Astro</h1>

    <div id="map" style="width: 100%; height: 500px;"></div>

    <script>
      if (mapData) {
        // Google Maps API script'ini dinamik olarak ekliyoruz
        const script = document.createElement('script');
        script.src = `https://maps.googleapis.com/maps/api/js?key=${mapData.apiKey}&libraries=places&v=beta`;
        script.async = true;
        script.onload = () => {
          initMap(mapData.mapConfig);
        };
        document.head.appendChild(script);

        function initMap(mapConfig) {
          new google.maps.Map(document.getElementById("map"), {
            center: mapConfig.center,
            zoom: mapConfig.zoom,
          });
        }
      }
    </script>
  </body>
</html>
